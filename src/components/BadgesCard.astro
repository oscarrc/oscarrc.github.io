---
import type { TagStats, SeriesStats } from "@/types";
import Icon from "./Icon.astro";

interface Props {
  title: string;
  badges: TagStats[] | SeriesStats[];
  class?: string;
  type: "tags" | "series";
  collection?: "posts" | "projects";
  variant?: "primary" | "secondary" | "accent" | "neutral";
}

const {
  title,
  badges,
  type,
  class: className,
  collection,
  variant = "primary",
} = Astro.props;

const variantClass = {
  primary: "badge-primary",
  secondary: "badge-secondary",
  accent: "badge-accent",
  neutral: "badge-neutral",
}[variant];

// Helper to get count from badge based on type and collection
const getCount = (badge: TagStats | SeriesStats): number => {
  if (type === "series") {
    return (badge as SeriesStats).postCount;
  }
  const tagBadge = badge as TagStats;
  if (collection === "posts") return tagBadge.postCount;
  if (collection === "projects") return tagBadge.projectCount;
  return tagBadge.totalCount;
};
---

<aside
  class={`relative card card-xs space-y-4 mx-auto max-w-4xl w-full  border rounded-box ${className}`}
>
  <h6
    class="absolute bg-base-100 -top-2.5 left-3 px-2 card-title flex-col text-sm items-start gap-0"
  >
    {title}
  </h6>
  <div class="card-body flex-row flex-wrap p-4 pt-6">
    {
      badges.map((badge) => (
        <a
          href={`/${type}/${badge.slug}/${collection ? `${collection}/` : ""}`}
          class={`badge badge-soft badge-xs ${variantClass} truncate space-x-2 text-xs`}
        >
          {badge.name}{" "}
          <span class={`badge badge-xs size-3 text-xs ${variantClass}`}>
            {getCount(badge)}
          </span>
        </a>
      ))
    }
    <a
      href={`/${type}`}
      class={`badge badge-outline badge-xs ${variantClass} truncate space-x-2 text-2xs`}
    >
      View all
      <Icon name="chevronRight" />
    </a>
  </div>
</aside>
