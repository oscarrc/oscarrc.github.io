---
import { render, type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import Icon from "./Icon.astro";

interface Props {
  post: CollectionEntry<"posts">;
}

const { post } = Astro.props;

const { remarkPluginFrontmatter } = await render(post);
const description =
  remarkPluginFrontmatter.description || post.data.description;

const tags = post.data.tags;
const cover = post.data.cover;
const author = post.data.author;
const series = post.data.series;

const date = new Date(post.data.published).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

const samePage = Astro.url.pathname === `/posts/${post.id}`;
const articleLink = samePage ? `#${post.id}` : `/posts/${post.id}`;
---

<article class="w-full flex flex-col gap-4 py-4">
  <div class="flex flex-col gap-1">
    <h1 class="text-2xl font-semibold">
      <a href={articleLink}>## {post.data.title}</a>
    </h1>
    <div class="flex items-center gap-2 text-primary/50 text-sm">
      <time>
        <Icon name="calendar" />
        {date}
      </time>
      {
        author && (
          <>
            <span>Â·</span>
            <span>
              <Icon name="user" />
              {author}
            </span>
          </>
        )
      }
    </div>
  </div>
  {description && <p class="text-accent">{description}</p>}
  {
    tags && (
      <div class="flex flex-wrap gap-2">
        {series && (
          <a href={`/series/${series}`} class="badge badge-soft badge-accent">
            <Icon name="book" />
            {series}
          </a>
        )}
        {tags.map((tag) => (
          <a href={`/tags/${tag}`} class="badge badge-soft badge-primary">
            {tag}
          </a>
        ))}
      </div>
    )
  }
  <div class="flex gap-2 mt-2">
    <a class="btn btn-primary btn-outline btn-sm" href={articleLink}>
      Read
      <Icon name="chevronRight" />
    </a>
  </div>
</article>
