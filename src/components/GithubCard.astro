---
import { fetchGithubRepoData } from "@/utils/github";
import Icon from "./Icon.astro";

interface Props {
  repo: string;
}

const { repo } = Astro.props;

const repoData = await fetchGithubRepoData(repo);

const repoUrl = repoData?.html_url || `https://github.com/${repo}`;
const name = repoData?.name || repo.split("/").pop() || repo;
const description = repoData?.description || "";
const stars = repoData?.stargazers_count || 0;
const watchers = repoData?.watchers_count || 0;
const forks = repoData?.forks_count || 0;
---

<a
  href={repoUrl}
  target="_blank"
  rel="noopener noreferrer"
  class="card bg-base-content text-base-300 cursor-pointer block max-w-4xl 2xl:max-w-xs mx-auto w-full"
>
  <div class="card-body p-4 sm:p-6">
    <div class="flex items-center gap-2 mb-2">
      <Icon name="github" class="text-4xl flex-shrink-0" />
      <h2 class="card-title text-lg sm:text-xl truncate">{name}</h2>
    </div>
    {
      description && (
        <p class="text-sm sm:text-base opacity-90 line-clamp-2 mb-3">
          {description}
        </p>
      )
    }
    <div class="card-actions justify-between items-center mt-auto pt-2">
      <div
        class="flex items-center gap-3 sm:gap-4 text-xs sm:text-sm opacity-80 flex-wrap"
      >
        <div class="flex items-center gap-2">
          <Icon name="eye" class="text-2xl" />
          <span>{watchers.toLocaleString()}</span>
        </div>
        <span>|</span>
        <div class="flex items-center gap-2">
          <Icon name="fork" class="text-xl" />
          <span>{forks.toLocaleString()}</span>
        </div>
        <span>|</span>
        <div class="flex items-center gap-2">
          <Icon name="star" class="text-2xl" />
          <span>{stars.toLocaleString()}</span>
        </div>
      </div>
    </div>
  </div>
</a>
