---
import { render, type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import Icon from "./Icon.astro";

interface Props {
  project: CollectionEntry<"projects">;
}

const { project } = Astro.props;

const { remarkPluginFrontmatter } = await render(project);
const description =
  remarkPluginFrontmatter.description || project.data.description;

const tags = project.data.tags;
const repo = project.data.repo;
const url = project.data.url?.trim();
const active = project.data.active ?? true;
const cover = project.data.cover;

const date = new Date(project.data.published).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

const samePage = Astro.url.pathname === `/projects/${project.id}`;
const articleLink = samePage ? `#${project.id}` : `/projects/${project.id}`;
---

<article class="w-full flex flex-col gap-4 py-4">
  <div class="flex flex-col gap-1">
    <h1 class="text-2xl font-semibold">
      <a href={articleLink}>## {project.data.title}</a>
    </h1>
    <div class="flex items-center gap-2 text-neutral text-sm">
      <time>
        <Icon name="calendar" />
        {date}
      </time>
      {
        repo && (
          <>
            <span>|</span>
            <a
              href={`https://github.com/${repo}`}
              target="_blank"
              rel="noopener noreferrer"
            >
              <Icon name="github" />
              {repo}
            </a>
          </>
        )
      }
    </div>
  </div>
  {description && <p class="text-accent">{description}</p>}
  {
    tags && (
      <div class="flex flex-wrap gap-2">
        {tags.map((tag) => (
          <a href={`/tags/${tag}`} class="badge badge-soft badge-primary">
            {tag}
          </a>
        ))}
      </div>
    )
  }
  <div class="flex gap-2 mt-2">
    <div class:list={[{ "tooltip tooltip-top": cover }]}>
      <div
        class="tooltip-content w-80 p-0 bg-base-100 border border-base-300 rounded-lg shadow-lg"
      >
        <div class="browser-mockup">
          <div
            class="browser-mockup-header flex items-center gap-2 px-3 py-2 bg-base-200 border-b border-base-300"
          >
            <div class="flex gap-1">
              <div class="size-2 rounded-full bg-error"></div>
              <div class="size-2 rounded-full bg-warning"></div>
              <div class="size-2 rounded-full bg-success"></div>
            </div>
            <div
              class="flex-1 bg-base-100 rounded px-2 py-1 text-xs text-left text-base-content/70"
            >
              {url}
              {!active && "(Inactive)"}
            </div>
          </div>
          {
            cover && (
              <Image
                src={cover.src}
                alt={cover.alt}
                class="w-full h-48 object-cover rounded-b-lg"
              />
            )
          }
        </div>
      </div>
      {
        active && url ? (
          <a
            class="btn btn-primary btn-sm"
            href={url}
            target="_blank"
            rel="noopener noreferrer"
          >
            Visit Site
            <Icon name="external" />
          </a>
        ) : (
          <button class="btn btn-primary btn-sm" disabled>
            Visit Site
            <Icon name="external" />
          </button>
        )
      }
    </div>

    <a class="btn btn-outline btn-sm" href={articleLink}>
      {samePage ? "Continue" : "Read"}
      <Icon name="chevronRight" />
    </a>
  </div>
</article>
