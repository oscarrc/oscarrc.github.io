---
import BadgesCard from "@/components/BadgesCard.astro";
import Pagination from "@/components/Pagination.astro";
import ProjectCard from "@/components/ProjectCard.astro";
import Section from "@/components/Section.astro";
import Layout from "@/layouts/Layout.astro";
import siteConfig from "@/site.config";
import { getSortedCollection, getSortedTags } from "@/utils/collections";
import type { GetStaticPaths } from "astro";

export const getStaticPaths = (async ({ paginate }) => {
  const projects = await getSortedCollection("projects");
  return paginate(projects, { pageSize: siteConfig.pageSize });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

const projects = page.data;
const tags = (await getSortedTags(["projects"])).slice(0, 10);
---

<Layout>
  <Section class="flex flex-col gap-8">
    <div class="flex flex-col gap-16">
      <div class="flex flex-col gap-8 lg:min-w-full">
        {projects.map((project) => <ProjectCard project={project} />)}
        <Pagination
          prevLink={page.url.prev}
          prevText="Newer Projects"
          nextLink={page.url.next}
          nextText="Older Projects"
        />
      </div>
    </div>
  </Section>
  <div
    class="2xl:sticky 2xl:top-10 max-w-4xl mx-auto flex flex-col gap-16 p-6"
    slot="right"
  >
    {
      tags?.length > 0 ? (
        <BadgesCard
          badges={tags}
          type="tags"
          collection="projects"
          title="Top tags"
          variant="primary"
        />
      ) : null
    }
  </div>
</Layout>
